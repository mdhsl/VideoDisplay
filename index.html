<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>Video display</title>
		
		<script src="js/jquery-2.2.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		
		<!---------------- OSH ------------------>
		<!-- LEAFLET libs -->
	    <link rel="stylesheet" href="OSH-js/vendor/leaflet/leaflet.css" />	
	    <script src="OSH-js/vendor/leaflet/leaflet.js"></script>
	    <!-- FullScreen -->
	    <script src='OSH-js/vendor/leaflet/Leaflet.fullscreen.min.js'></script>
	    <link href='OSH-js/vendor/leaflet/leaflet.fullscreen.css' rel='stylesheet' />
	    
	    <!--  CESIUM libs -->
	    <script src="OSH-js/vendor/cesium/Cesium.js"></script>
	    <link rel="stylesheet" type="text/css" href="OSH-js/vendor/cesium/Widgets/widgets.css" />
	
	    <!-- OSH libs -->
	    <!-- Hashtable -->
	    <script type="text/javascript" src= "OSH-js/src/common/prototype.min.js"></script>
	    
	    <!-- OSH Core -->
	    <script type="text/javascript" src="OSH-js/src/osh/osh-template.js"></script>
	    <!-- OSH buffer sync lib -->
	    <script type="text/javascript" src="OSH-js/src/osh/osh-Utils.js"></script>
	    
	    <script type="text/javascript" src="OSH-js/src/osh/osh-Buffer.js"></script>
	    <!-- OSH controller lib -->
	    <script type="text/javascript" src="OSH-js/src/osh/osh-Controller.js"></script>
	    <!-- OSH Video component parser -->
	    <script type="text/javascript" src="OSH-js/src/osh/dataconnector/osh-DataConnector.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataconnector/osh-DataConnector-Websocket.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProviderController.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-LatLonAlt.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-OrientationQuaternion.js"></script>
	      <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-VideoH264.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-VideoMjpeg.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-VideoMp4.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/dataprovider/osh-DataProvider-Video.js"></script>
	    
	    <script type="text/javascript" src="OSH-js/src/osh/ui/styler/osh-UI-Styler.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/styler/osh-UI-StylerPointMarker.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/styler/osh-UI-StylerPolyline.js"></script>
	    
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-View.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-LeafletView.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-CesiumView.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-MjpegView.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-Mp4View.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-H264View.js"></script>
	    <script type="text/javascript" src="OSH-js/src/osh/ui/view/osh-UI-VideoView.js"></script>
	
		<!------------ VIDEO DISPLAY ------------>
		<link rel="stylesheet" type="text/css" href="css/video-display.css">
		<script type="text/javascript" src="js/patch-prototype-bootstrap.js"></script>
	</head>

	<body>
	  <nav class="navbar navbar-default navbar-inverse ">
	    <div class="container-fluid">
	      <div class="navbar-header">
	        <a class="navbar-brand" href="http://www.opensensorhub.org/">
	          <img src="https://github.com/sensiasoft/sensorhub/wiki/images/sensorhub_logo_128.png" style="-webkit-animation-play-state: paused; -webkit-transition: none; transition: none; width:50px;height:50px;">
	        OpenSensorHub</a>
	      </div>
	    </div>
	  </nav>
     <div id="main-container" class="main-view"></div>
     <div style="position:absolute;top:60px;right:15px;">
	     <div id="container-video1" class="video-box"></div>
		 <div id="container-video2" class="video-box"></div>
		 <div id="container-video3" class="video-box"></div>
		 <div id="container-video4" class="video-box"></div>
	 </div>
	 <script type="text/javascript">
		var dataProviderController = new OSH.DataProvider.DataProviderController({
			bufferingTime : 2*1000, // 0 seconds
			synchronizedTime : false // does not sync the data
		});

		// creates datasource
		
		//--Android Phone Video, Orientation and GPS Location (MJPEG)
		var androidPhoneGpsDataSource = new OSH.DataProvider.LatLonAlt("android-GPS", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:android:device:89845ed469b7edc7-sos",
		  observedProperty: "http://sensorml.com/ont/swe/property/Location",
		  startTime: "2016-06-08T19:46:24.732Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		});
		
		var androidPhoneOrientationDataSource = new OSH.DataProvider.OrientationQuaternion("android-Orientation", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:android:device:89845ed469b7edc7-sos",
		  observedProperty: "http://sensorml.com/ont/swe/property/OrientationQuaternion",
		  startTime: "2016-06-08T19:46:24.732Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		});
		
		var androidPhoneVideoDataSource = new OSH.DataProvider.VideoMjpeg("android-Video", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:android:device:89845ed469b7edc7-sos",
		  observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
		  startTime: "2016-06-08T19:46:24.732Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		},{
			format: "mjpeg"					
		});
		//--
		
		//--Virb Video (MP4) and GPS Location
		var virb1GpsDataSource = new OSH.DataProvider.LatLonAlt("virb1-GPS", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:osh:virb1",
		  observedProperty: "http://www.opengis.net/def/property/OGC/0/SensorLocation",
		  startTime: "2016-06-08T19:35:27.413Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		});
		
		var virb1VideoDataSource = new OSH.DataProvider.VideoMp4("virb1-Video", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:osh:virb1",
		  observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
		  startTime: "2016-06-08T19:35:27.413Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1",
		  responseFormat: "video/mp4"
		},{
			format: "mp4"					
		});
		
		var virb2GpsDataSource = new OSH.DataProvider.LatLonAlt("virb2-GPS", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:osh:virb2",
		  observedProperty: "http://www.opengis.net/def/property/OGC/0/SensorLocation",
		  startTime: "2016-06-08T19:35:27.413Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		});
		
		var virb2VideoDataSource = new OSH.DataProvider.VideoMp4("virb2-Video", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:osh:virb2",
		  observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
		  startTime: "2016-06-08T19:35:27.413Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1",
		  responseFormat: "video/mp4"
		},{
			format: "mp4"					
		});
			
		//--
		
		//-- Thermal IR video from FLIR (MJPEG)
		var flirVideoDataSource = new OSH.DataProvider.VideoMjpeg("flir-Video", {
		  protocol : "ws",
		  service: "SOS",
		  endpointUrl: "www.bottsgeo.com:8080/sensorhub/sos",
		  offeringID: "urn:android:device:89845ed469b7edc7:flirone-sos",
		  observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
		  startTime: "2016-06-08T19:59:31.535Z",
		  endTime: "2016-06-08T20:35:06.983Z",
		  replaySpeed: "1"
		},{
			format: "mjpeg"					
		});
		//--
		
		//--TruPulse Range Finder
		
		// creates entities
		var androidEntity = {
			dataSources: [androidPhoneGpsDataSource.getId(), androidPhoneOrientationDataSource.getId(), androidPhoneVideoDataSource.getId()]
		}
		
		var virb1Entity = {
			dataSources: [virb1GpsDataSource.getId(), virb1VideoDataSource.getId()]
		}
		
		var virb2Entity = {
			dataSources: [virb2GpsDataSource.getId(), virb2VideoDataSource.getId()]
		}
		
		var flirEntity = {
			dataSources: [androidPhoneGpsDataSource.getId(), flirVideoDataSource.getId()]	
		}
		
		// creates view
		var leafletView = new OSH.UI.LeafletView("main-container");
		
		var videoView1 = new OSH.UI.VideoView("container-video1",{
			dataSourceId:androidPhoneVideoDataSource.getId(),
			format: "mjpeg",
			css:"video",
			cssSelected:"video-selected"
		});
		
		var videoView2 = new OSH.UI.VideoView("container-video2",{
			dataSourceId:virb1VideoDataSource.getId(),
			format: "mp4",
			css:"video",
			cssSelected:"video-selected"
		});
		
		var videoView3 = new OSH.UI.VideoView("container-video3",{
			dataSourceId:virb2VideoDataSource.getId(),
			format: "mp4",
			css:"video",
			cssSelected:"video-selected"
		});
		
		var videoView4 = new OSH.UI.VideoView("container-video4",{
			dataSourceId:flirVideoDataSource.getId(),
			format: "mjpeg",
			css:"video",
			cssSelected:"video-selected"
		});
		
		// creates stylers
		var androidMarkerStyler = new OSH.UI.Styler.PointMarker({
			location : {
				x : -86.7433953,
				y : 34.7255687,
				z : 100
			},
			locationFunc : {
				dataSourceIds : [androidPhoneGpsDataSource.getId()],
				handler : function(rec) {
					return {
						x : rec.lon,
						y : rec.lat,
						z : rec.alt
					};
				}
			},
			orientationFunc : {
				dataSourceIds : [androidPhoneOrientationDataSource.getId()],
				handler : function(rec) {
					return {
						heading : rec.heading
					};
				}
			},
			icon : 'images/cameralook.png',
			iconFunc : {
				dataSourceIds: [androidPhoneGpsDataSource.getId()],
				handler : function(rec,options) {
					if(options.selected) {
						return 'images/cameralook-selected.png'
					} else {
						return 'images/cameralook.png';
					};
				}
			}
		});
		
		var virb1MarkerStyler = new OSH.UI.Styler.PointMarker({
			location : {
				x : -86.7433953,
				y : 34.7255687,
				z : 100
			},
			locationFunc : {
				dataSourceIds : [virb1GpsDataSource.getId()],
				handler : function(rec) {
					return {
						x : rec.lon,
						y : rec.lat,
						z : rec.alt
					};
				}
			},
			icon : 'images/cameralook.png',
			iconFunc : {
				dataSourceIds: [virb1GpsDataSource.getId()],
				handler : function(rec,options) {
					if(options.selected) {
						return 'images/cameralook-selected.png'
					} else {
						return 'images/cameralook.png';
					};
				}
			}
		});
		
		var virb2MarkerStyler = new OSH.UI.Styler.PointMarker({
			location : {
				x : -86.7433953,
				y : 34.7255687,
				z : 100
			},
			locationFunc : {
				dataSourceIds : [virb2GpsDataSource.getId()],
				handler : function(rec) {
					return {
						x : rec.lon,
						y : rec.lat,
						z : rec.alt
					};
				}
			},
			icon : 'images/cameralook.png',
			iconFunc : {
				dataSourceIds: [virb2GpsDataSource.getId()],
				handler : function(rec,options) {
					if(options.selected) {
						return 'images/cameralook-selected.png'
					} else {
						return 'images/cameralook.png';
					};
				}
			}
		});
		
		// adds view item to the view
		leafletView.addViewItem({
			styler : androidMarkerStyler,
			name : "android-phone"
		});

		leafletView.addViewItem({
			styler : virb1MarkerStyler,
			name: "virb 1"
		});
		
		leafletView.addViewItem({
			styler : virb2MarkerStyler,
			name: "virb 2"
		});
		
		// adds datasources to dataProviderController
		dataProviderController.addDataSource(androidPhoneGpsDataSource);
		dataProviderController.addDataSource(androidPhoneOrientationDataSource);
		dataProviderController.addDataSource(androidPhoneVideoDataSource);
		dataProviderController.addDataSource(virb1GpsDataSource);
		dataProviderController.addDataSource(virb1VideoDataSource);
		dataProviderController.addDataSource(virb2GpsDataSource);
		dataProviderController.addDataSource(virb2VideoDataSource);
		dataProviderController.addDataSource(flirVideoDataSource);
		
		// registers the view into the data provider
		dataProviderController.registerObserver(leafletView);
		dataProviderController.registerObserver(videoView1);
		dataProviderController.registerObserver(videoView2);
		dataProviderController.registerObserver(videoView3);
		dataProviderController.registerObserver(videoView4);
		
		// adds controller to interact between views
		var controller = new OSH.Controller();
		controller.addView(leafletView);
		controller.addView(videoView1);
		controller.addView(videoView2);
		controller.addView(videoView3);
		controller.addView(videoView4);
		
		// adds entities to controller
		controller.addEntity(androidEntity);
		controller.addEntity(virb1Entity);
		controller.addEntity(virb2Entity);
		controller.addEntity(flirEntity);
		
		// starts streaming
		dataProviderController.connectAll();
		
	</script>
	</body>
</html>
